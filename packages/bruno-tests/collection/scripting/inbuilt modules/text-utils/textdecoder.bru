meta {
  name: textdecoder
  type: http
  seq: 2
}

post {
  url: https://echo.usebruno.com
  body: none
  auth: inherit
}

assert {
  res.status: eq 200
}

tests {
  const { doesUint8ArraysWorkAsExpected, getTextDecoder } = require('./scripting/inbuilt modules/utils.js');

  if (!doesUint8ArraysWorkAsExpected()) {
    console.warn('Uint8Array does not work as expected in vm2');
    return;
  }

  test("should decode typedarray to text using TextDecoder", function() {
    const decoder = getTextDecoder();
    const decodedText = decoder.decode(new Uint8Array([116, 101, 120, 116]));
    
    const isdecodedTextOfTypeString = typeof decodedText === 'string';
    expect(isdecodedTextOfTypeString).to.be.true;
  });
}

settings {
  encodeUrl: true
}
